[Unit]
# Ensure we start after graphical session is ready
After=graphical-session-pre.target
BindsTo=graphical-session.target

[Service]
# Import session environment variables before starting emacs.
# graphical-session-pre.target is where GNOME exports these, so
# After= above ensures they're available by the time this runs.
ExecStartPre=/bin/bash -c 'systemctl --user import-environment DISPLAY WAYLAND_DISPLAY XDG_SESSION_TYPE'
PassEnvironment=DISPLAY WAYLAND_DISPLAY

[Install]
# Override default.target â€” start with the graphical session instead,
# so environment variables (WAYLAND_DISPLAY, etc.) are available.
WantedBy=graphical-session.target
